name = "mh-construction-website"
main = "src/index.js"
compatibility_date = "2024-10-16"

[env.production]
name = "mh-construction-prod"
account_id = "${CLOUDFLARE_ACCOUNT_ID}"
zone_id = "${CLOUDFLARE_ZONE_ID}"

[env.staging]
name = "mh-construction-staging"
account_id = "${CLOUDFLARE_ACCOUNT_ID}"
zone_id = "${CLOUDFLARE_ZONE_ID}"

# Custom domain configuration
route = "mhc-gc.com/*"

# Environment variables
[vars]
ENVIRONMENT = "production"
API_BASE_URL = "https://api.mhc-gc.com"
FIREBASE_PROJECT_ID = "${FIREBASE_PROJECT_ID}"

# KV Namespaces for caching
[[kv_namespaces]]
binding = "CACHE"
id = "${CLOUDFLARE_KV_NAMESPACE_ID}"
preview_id = "${CLOUDFLARE_KV_PREVIEW_NAMESPACE_ID}"

[[kv_namespaces]]
binding = "ANALYTICS"
id = "${CLOUDFLARE_ANALYTICS_KV_ID}"
preview_id = "${CLOUDFLARE_ANALYTICS_KV_PREVIEW_ID}"

# Durable Objects for real-time features
[[durable_objects.bindings]]
name = "CHAT_SESSION"
class_name = "ChatSessionDO"

# R2 bucket for file storage
[[r2_buckets]]
binding = "ASSETS"
bucket_name = "mh-construction-assets"

# Security and performance settings
[wrangler]
send_metrics = false

# Build configuration
[build]
command = "npm run build"
cwd = "."
watch_dir = ["src", "public"]

# Compatibility flags for modern features
compatibility_flags = [
  "streams_enable_constructors",
  "transformstream_enable_standard_constructor"
]

# Tail workers for logging
[[tail_consumers]]
service = "mh-construction-logger"

# Rules configuration for URL routing
[[rules]]
type = "Rule"
globs = ["*.html", "*.css", "*.js", "*.png", "*.jpg", "*.ico"]
# These will be served from static assets

# Security rules
[[rules]]
type = "Rule"
globs = ["/admin/*"]
# Admin routes require authentication

# Analytics and monitoring
[observability]
enabled = true

# Site configuration
[site]
bucket = "mh-construction-static"
entry-point = "workers-site"
